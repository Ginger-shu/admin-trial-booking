<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«”é©—èª²é ç´„ç®¡ç† | è¡¡é»å¥èº«</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            /* å“ç‰Œè‰²ç³» */
            --white: #ffffff;
            --gray: #808080;
            --gray-light: #f5f5f5;
            --green: #7ac19a;
            --green-light: #e2ede6;
            --green-dark: #5f846f;
            --pink: #f2ac98;
            --pink-light: #faece8;
            --pink-dark: #c67566;
            --yellow: #ffe08b;
            --yellow-light: #fcf4e3;
            --yellow-dark: #ba9e60;
            --blue: #9fcccc;
            --blue-light: #daedec;
            --blue-dark: #66888e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-light);
            min-height: 100vh;
        }

        /* ===== Headerï¼ˆæ˜é¡è—ï¼‰===== */
        .header {
            background: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 8px;
        }

        /* ===== Container ===== */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }

        /* ===== Tabsï¼ˆæ˜é¡è—ï¼‰===== */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 10px 5px;
            text-align: center;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray);
        }

        .tab.active {
            background: var(--blue);
            color: white;
        }

        .tab .count {
            display: inline-block;
            background: var(--pink);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .tab.active .count {
            background: white;
            color: var(--blue-dark);
        }

        /* ===== Statsï¼ˆé»ƒç¶ ç²‰æ•¸å­—ï¼‰===== */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-card.pending .stat-number { color: var(--yellow-dark); }
        .stat-card.confirmed .stat-number { color: var(--green-dark); }
        .stat-card.cancelled .stat-number { color: var(--pink-dark); }

        .stat-label {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* ===== Booking List ===== */
        .booking-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .booking-card {
            background: white;
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--yellow);
        }

        .booking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .booking-card.confirmed {
            border-left-color: var(--green);
        }

        .booking-card.cancelled {
            border-left-color: var(--gray);
            opacity: 0.7;
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .booking-id {
            font-size: 12px;
            color: var(--gray);
        }

        .booking-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .booking-status.pending {
            background: var(--yellow-light);
            color: var(--yellow-dark);
        }

        .booking-status.confirmed {
            background: var(--green-light);
            color: var(--green-dark);
        }

        .booking-status.cancelled {
            background: var(--gray-light);
            color: var(--gray);
        }

        .booking-course {
            font-size: 16px;
            font-weight: 600;
            color: var(--blue-dark);
            margin-bottom: 8px;
        }

        .booking-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            color: #666;
        }

        .booking-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .booking-deadline {
            font-size: 12px;
            color: var(--pink-dark);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }

        .booking-coach {
            font-size: 12px;
            color: var(--green-dark);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }

        .booking-cancel-reason {
            font-size: 12px;
            color: var(--pink-dark);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }

        /* ===== Modal ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Modal Headerï¼ˆè—è‰²æ·ºåº•ï¼‰*/
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--blue-light);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--blue-dark);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: var(--gray);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 10px;
        }

        /* Info Boxï¼ˆè—é»ƒæ­é…ï¼‰*/
        .info-box {
            background: var(--yellow-light);
            border-radius: 12px;
            padding: 15px;
        }

        .info-box.blue {
            background: var(--blue-light);
        }

        .info-box.green {
            background: var(--green-light);
        }

        .info-box.pink {
            background: var(--pink-light);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--gray);
            font-size: 13px;
        }

        .info-value {
            font-weight: 600;
            color: var(--yellow-dark);
            font-size: 14px;
        }

        .info-box.blue .info-value {
            color: var(--blue-dark);
        }

        .info-box.green .info-value {
            color: var(--green-dark);
        }

        .info-box.pink .info-value {
            color: var(--pink-dark);
        }

        /* ===== Form Elements ===== */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--blue);
        }

        textarea.form-select {
            resize: vertical;
            min-height: 80px;
        }

        /* Coach Options */
        .coach-option {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coach-option:hover {
            border-color: var(--blue);
            background: var(--blue-light);
        }

        .coach-option.selected {
            border-color: var(--blue);
            background: var(--blue-light);
        }

        .coach-option.original {
            border-color: var(--yellow);
            background: var(--yellow-light);
        }

        .coach-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .coach-option.selected .coach-radio {
            border-color: var(--blue);
        }

        .coach-option.selected .coach-radio::after {
            content: '';
            width: 10px;
            height: 10px;
            background: var(--blue);
            border-radius: 50%;
        }

        .coach-name {
            font-weight: 600;
            color: #333;
        }

        .coach-tag {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--yellow);
            color: var(--yellow-dark);
        }

        /* Checkbox */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 15px;
            background: var(--green-light);
            border-radius: 10px;
            border: 2px solid var(--green-light);
            transition: all 0.3s;
        }

        .checkbox-label:hover {
            border-color: var(--green);
        }

        .checkbox-label.checked {
            border-color: var(--green);
            background: var(--green-light);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .checkbox.checked {
            background: var(--green);
            border-color: var(--green);
        }

        .checkbox.checked::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        /* ===== Buttons ===== */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-confirm {
            background: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(159, 204, 204, 0.4);
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(159, 204, 204, 0.5);
        }

        .btn-confirm:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .btn-cancel {
            background: var(--pink-light);
            color: var(--pink-dark);
            margin-top: 10px;
        }

        .btn-cancel:hover {
            background: var(--pink);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--gray);
        }

        /* ===== Loading ===== */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--blue-light);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state .icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        /* ===== Unauthorized ===== */
        .unauthorized {
            text-align: center;
            padding: 60px 20px;
        }

        .unauthorized .icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .unauthorized h2 {
            color: var(--pink-dark);
            margin-bottom: 10px;
        }

        .unauthorized p {
            color: var(--gray);
            font-size: 14px;
        }

        /* ===== Toast ===== */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 2000;
            animation: toastIn 0.3s ease;
        }

        .toast.success {
            background: var(--green-dark);
        }

        .toast.error {
            background: var(--pink-dark);
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* ===== Section ===== */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ===== Warning Box ===== */
        .warning-box {
            background: var(--yellow-light);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .warning-box p {
            font-size: 13px;
            color: var(--yellow-dark);
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>â”€ è¡¡é» â”€</h1>
        <p>ğŸ“‹ é«”é©—èª²é ç´„ç®¡ç†</p>
    </div>

    <div class="container">
        <!-- Loading Section -->
        <div class="section active" id="loadingSection">
            <div class="loading">
                <div class="spinner"></div>
                <p>è¼‰å…¥ä¸­...</p>
            </div>
        </div>

        <!-- Unauthorized Section -->
        <div class="section" id="unauthorizedSection">
            <div class="unauthorized">
                <div class="icon">ğŸ”’</div>
                <h2>ç„¡æ³•å­˜å–</h2>
                <p>æ‚¨æ²’æœ‰æ¬Šé™ä½¿ç”¨æ­¤ç³»çµ±<br>è«‹è¯ç¹«ç®¡ç†å“¡</p>
            </div>
        </div>

        <!-- Main Section -->
        <div class="section" id="mainSection">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card pending">
                    <div class="stat-number" id="pendingCount">0</div>
                    <div class="stat-label">å¾…ç¢ºèª</div>
                </div>
                <div class="stat-card confirmed">
                    <div class="stat-number" id="confirmedCount">0</div>
                    <div class="stat-label">å·²ç¢ºèª</div>
                </div>
                <div class="stat-card cancelled">
                    <div class="stat-number" id="cancelledCount">0</div>
                    <div class="stat-label">å·²å–æ¶ˆ</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" data-tab="pending" onclick="switchTab('pending')">
                    å¾…ç¢ºèª <span class="count" id="pendingTabCount">0</span>
                </div>
                <div class="tab" data-tab="confirmed" onclick="switchTab('confirmed')">
                    å·²ç¢ºèª
                </div>
                <div class="tab" data-tab="cancelled" onclick="switchTab('cancelled')">
                    å·²å–æ¶ˆ
                </div>
                <div class="tab" data-tab="all" onclick="switchTab('all')">
                    å…¨éƒ¨
                </div>
            </div>

            <!-- Booking List -->
            <div class="booking-list" id="bookingList">
                <!-- Bookings will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">ğŸ“‹ é ç´„è©³æƒ…</div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- é ç´„è³‡è¨Š -->
                <div class="modal-section">
                    <div class="modal-section-title">é ç´„è³‡è¨Š</div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">é ç´„ç·¨è™Ÿ</span>
                            <span class="info-value" id="modalBookingId">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">èª²ç¨‹é¡å‹</span>
                            <span class="info-value" id="modalCourse">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">é ç´„æ—¥æœŸ</span>
                            <span class="info-value" id="modalDate">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">é ç´„æ™‚æ®µ</span>
                            <span class="info-value" id="modalTime">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å­¸ç”Ÿ</span>
                            <span class="info-value" id="modalDisplayName">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">çµå¸³æœŸé™</span>
                            <span class="info-value" id="modalDeadline">-</span>
                        </div>
                    </div>
                </div>

                <!-- åˆ†é…æ•™ç·´ï¼ˆå¾…ç¢ºèªç‹€æ…‹é¡¯ç¤ºï¼‰ -->
                <div class="modal-section" id="coachSection">
                    <div class="modal-section-title">é¸æ“‡/èª¿æ•´æ•™ç·´</div>
                    <div id="coachList">
                        <!-- Coach options will be loaded here -->
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ•ï¼ˆå¾…ç¢ºèªç‹€æ…‹é¡¯ç¤ºï¼‰ -->
                <div id="actionButtons">
                    <button class="btn btn-confirm" id="confirmBtn" onclick="confirmBooking()" disabled>
                        âœ… ç¢ºèªä»˜æ¬¾ä¸¦åˆ†é…æ•™ç·´
                    </button>
                    <button class="btn btn-cancel" onclick="showCancelConfirm()">
                        âŒ å–æ¶ˆæ­¤é ç´„
                    </button>
                </div>

                <!-- å·²ç¢ºèªç‹€æ…‹é¡¯ç¤º -->
                <div id="confirmedInfo" style="display: none;">
                    <div class="info-box green">
                        <div class="info-row">
                            <span class="info-label">åˆ†é…æ•™ç·´</span>
                            <span class="info-value" id="modalCoach">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç¢ºèªæ™‚é–“</span>
                            <span class="info-value" id="modalConfirmTime">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç¢ºèªäººå“¡</span>
                            <span class="info-value" id="modalConfirmBy">-</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-cancel" onclick="showRefundCancelModal()" style="margin-top: 15px;">
                        âŒ å–æ¶ˆé ç´„ï¼ˆå·²ä»˜æ¬¾ï¼‰
                    </button>
                </div>

                <!-- å·²å–æ¶ˆç‹€æ…‹é¡¯ç¤º -->
                <div id="cancelledInfo" style="display: none;">
                    <div class="info-box pink">
                        <div class="info-row">
                            <span class="info-label">å–æ¶ˆåŸå› </span>
                            <span class="info-value" id="modalCancelReason">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å–æ¶ˆæ™‚é–“</span>
                            <span class="info-value" id="modalCancelTime">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å–æ¶ˆäººå“¡</span>
                            <span class="info-value" id="modalCancelBy">-</span>
                        </div>
                        <div class="info-row" id="cancelNoteRow" style="display: none;">
                            <span class="info-label">å‚™è¨»</span>
                            <span class="info-value" id="modalCancelNote">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancel Confirm Modal -->
<div class="modal-overlay" id="cancelConfirmModal">
    <div class="modal" style="max-width: 400px;">
        <div class="modal-header">
            <div class="modal-title">âŒ å–æ¶ˆé ç´„ï¼ˆæœªä»˜æ¬¾ï¼‰</div>
            <button class="modal-close" onclick="closeCancelConfirm()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
                <textarea class="form-select" id="cancelNoteUnpaid" rows="3" placeholder="è¼¸å…¥å‚™è¨»..."></textarea>
            </div>
            
            <div class="warning-box">
                <p>
                    âš ï¸ ç¢ºèªå¾Œå°‡ï¼š<br>
                    â€¢ æ›´æ–°é ç´„ç‹€æ…‹ç‚ºã€Œå·²å–æ¶ˆã€<br>
                    â€¢ é‡‹å‡º Calendar æ™‚æ®µ<br>
                    â€¢ ç™¼é€ LINE é€šçŸ¥çµ¦é¡§å®¢
                </p>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeCancelConfirm()">å†æƒ³æƒ³</button>
                <button class="btn btn-cancel" onclick="cancelBooking()" style="margin-top: 0;">ç¢ºå®šå–æ¶ˆ</button>
            </div>
        </div>
    </div>
</div>

    <!-- Refund Cancel Modal (å·²ä»˜æ¬¾çš„å–æ¶ˆ) -->
    <div class="modal-overlay" id="refundCancelModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ’° å–æ¶ˆé ç´„ï¼ˆå·²ä»˜æ¬¾ï¼‰</div>
                <button class="modal-close" onclick="closeRefundCancelModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">å–æ¶ˆåŸå› </label>
                    <select class="form-select" id="cancelReason">
                        <option value="">è«‹é¸æ“‡åŸå› </option>
                        <option value="å­¸ç”Ÿå€‹äººå› ç´ ">å­¸ç”Ÿå€‹äººå› ç´ </option>
                        <option value="æ™‚é–“ç„¡æ³•é…åˆ">æ™‚é–“ç„¡æ³•é…åˆ</option>
                        <option value="æ•™ç·´ç•°å‹•">æ•™ç·´ç•°å‹•</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
                    <textarea class="form-select" id="cancelNote" rows="3" placeholder="è¼¸å…¥å‚™è¨»..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label" onclick="toggleRefundConfirm()">
                        <div class="checkbox" id="refundCheckbox"></div>
                        <span>âœ… ç¢ºèªå·²è¾¦ç†é€€æ¬¾</span>
                    </label>
                </div>
                
                <div class="warning-box">
                    <p>
                        âš ï¸ ç¢ºèªå¾Œå°‡ï¼š<br>
                        â€¢ æ›´æ–°é ç´„ç‹€æ…‹ç‚ºã€Œå·²å–æ¶ˆã€<br>
                        â€¢ é‡‹å‡º Calendar æ™‚æ®µ<br>
                        â€¢ ç™¼é€ LINE é€šçŸ¥çµ¦é¡§å®¢
                    </p>
                </div>
                
                <button class="btn btn-cancel" id="refundCancelBtn" onclick="confirmRefundCancel()" disabled style="margin-top: 0;">
                    ç¢ºèªå–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // âš™ï¸ è¨­å®šå€åŸŸ - è«‹åœ¨æ­¤å¡«å…¥æ‚¨çš„è³‡è¨Š
        // ============================================
        const CONFIG = {
            // ----------------------------------------
            // ğŸ“± LIFF ID
            // å¾ LINE Developers Console å–å¾—
            // è·¯å¾‘ï¼šLINE Developers > æ‚¨çš„ Provider > æ‚¨çš„ Channel > LIFF
            // ----------------------------------------
            LIFF_ID: '2007947083-8wLAewJR', // ğŸ‘ˆ å¡«å…¥æ‚¨çš„ LIFF IDï¼Œä¾‹å¦‚ï¼š'2007947083-xxxxxxxx'
            
            // ----------------------------------------
            // ğŸ”— Webhook URL (Make.com)
            // å»ºç«‹æ–°çš„ Scenarioï¼Œä½¿ç”¨ Webhook trigger
            // ç”¨æ–¼è™•ç†è¡Œæ”¿å¾Œå°çš„æ‰€æœ‰æ“ä½œ
            // ----------------------------------------
            WEBHOOK_URL: 'https://hook.us2.make.com/7rl2l8rb9fb606jse1hj1iwcw810b3fj', // ğŸ‘ˆ å¡«å…¥æ‚¨çš„ Make.com Webhook URL
            
            // ----------------------------------------
            // ğŸ“Š Google Sheets è¨­å®š
            // é ç´„è³‡æ–™çš„ Spreadsheet
            // ----------------------------------------
            SPREADSHEET_ID: '1WPrkqpOycQ0NvLmP8RYCIyxNl3Rn8kzfXFCIe50pfMg', // ğŸ‘ˆ æ‚¨çš„ Spreadsheet ID
            SHEET_NAME: 'é¡§å®¢é«”é©—èª²é ç´„' // ğŸ‘ˆ Sheet åç¨±
        };

        // ============================================
        // å…¨åŸŸè®Šæ•¸
        // ============================================
        let userId = null;
        let userProfile = null;
        let bookings = [];
        let currentBooking = null;
        let selectedCoach = null;
        let currentTab = 'pending';
        let refundConfirmed = false;

        // ============================================
        // é é¢åˆå§‹åŒ–
        // ============================================
        window.onload = function() {
    if (typeof liff === 'undefined') {
        showToast('LIFF SDK è¼‰å…¥å¤±æ•—', 'error');
        return;
    }
    initializePage();
};

        async function initializePage() {
    try {
        if (!CONFIG.LIFF_ID) {
            showToast('è«‹å…ˆè¨­å®š LIFF ID', 'error');
            return;
        }
        
        // LIFF åˆå§‹åŒ–ï¼ˆåŠ å…¥ timeoutï¼‰
        const liffInitPromise = liff.init({ liffId: CONFIG.LIFF_ID });
        const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('LIFF åˆå§‹åŒ–é€¾æ™‚')), 10000)
        );
        
        await Promise.race([liffInitPromise, timeoutPromise]);
        
        if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            userId = profile.userId;
            userProfile = profile;
            
            const authorized = await checkAuthorization(userId);
            if (!authorized) {
                showSection('unauthorizedSection');
                return;
            }
        } else {
            if (liff.isInClient()) {
                liff.login();
            } else {
                liff.login({ redirectUri: window.location.href });
            }
            return;
        }
        
        await loadBookings();
        showSection('mainSection');
        
    } catch (error) {
        console.error('Initialize failed:', error);
        showToast('åˆå§‹åŒ–å¤±æ•—ï¼š' + error.message, 'error');
    }
}

        // å‘¼å« Make.com é©—è­‰æˆæ¬Š
        // å‘¼å« Make.com é©—è­‰æˆæ¬Š
async function checkAuthorization(userId) {
    try {
        if (!CONFIG.WEBHOOK_URL) {
            console.error('è«‹å…ˆè¨­å®š WEBHOOK_URL');
            return false;
        }
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 15000);
        
        const response = await fetch(CONFIG.WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'checkAuthorization',
                userId: userId
            }),
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
            throw new Error('ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤: ' + response.status);
        }
        
        const result = await response.json();
        return result.authorized === true;
        
    } catch (error) {
        console.error('Authorization check failed:', error);
        if (error.name === 'AbortError') {
            showToast('é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯', 'error');
        }
        return false;
    }
}

        // ============================================
        // è¼‰å…¥é ç´„
        // ============================================
        async function loadBookings() {
    try {
        if (!CONFIG.WEBHOOK_URL) {
            showToast('è«‹å…ˆè¨­å®š Webhook URL', 'error');
            return;
        }
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 15000);
        
        const response = await fetch(CONFIG.WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'getBookings' }),
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
            throw new Error('ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤: ' + response.status);
        }
        
        bookings = await response.json();
        
        if (!Array.isArray(bookings)) {
            bookings = [];
        }
        
        updateStats();
        renderBookings();
        
    } catch (error) {
        console.error('Load bookings failed:', error);
        if (error.name === 'AbortError') {
            showToast('è¼‰å…¥é€¾æ™‚ï¼Œè«‹é‡è©¦', 'error');
        } else {
            showToast('è¼‰å…¥å¤±æ•—ï¼š' + error.message, 'error');
        }
        bookings = [];
        updateStats();
        renderBookings();
    }
}



        function updateStats() {
            const pending = bookings.filter(b => b.status === 'ä¿ç•™ä¸­').length;
            const confirmed = bookings.filter(b => b.status === 'å·²ç¢ºèª').length;
            const cancelled = bookings.filter(b => b.status === 'å·²å–æ¶ˆ' || b.status === 'å·²éæœŸ').length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('confirmedCount').textContent = confirmed;
            document.getElementById('cancelledCount').textContent = cancelled;
            document.getElementById('pendingTabCount').textContent = pending;
        }

        function renderBookings() {
            const list = document.getElementById('bookingList');
            
            let filtered = bookings;
            if (currentTab === 'pending') {
                filtered = bookings.filter(b => b.status === 'ä¿ç•™ä¸­');
            } else if (currentTab === 'confirmed') {
                filtered = bookings.filter(b => b.status === 'å·²ç¢ºèª');
            } else if (currentTab === 'cancelled') {
                filtered = bookings.filter(b => b.status === 'å·²å–æ¶ˆ' || b.status === 'å·²éæœŸ');
            }
            
            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>æ²’æœ‰é ç´„è³‡æ–™</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filtered.map(booking => `
                <div class="booking-card ${booking.status === 'å·²ç¢ºèª' ? 'confirmed' : ''} ${booking.status === 'å·²å–æ¶ˆ' || booking.status === 'å·²éæœŸ' ? 'cancelled' : ''}" 
                     onclick="openDetail('${booking.id}')">
                    <div class="booking-header">
                        <span class="booking-id">${booking.id}</span>
                        <span class="booking-status ${booking.status === 'ä¿ç•™ä¸­' ? 'pending' : booking.status === 'å·²ç¢ºèª' ? 'confirmed' : 'cancelled'}">
                            ${booking.status}
                        </span>
                    </div>
                    <div class="booking-course">${booking.course}</div>
                    <div class="booking-info">
                        <span>ğŸ‘¤ ${booking.displayName || '-'}</span>
                        <span>ğŸ“… ${formatDate(booking.date)}</span>
                        <span>â° ${booking.startTime} - ${booking.endTime}</span>
                    </div>
                    ${booking.status === 'ä¿ç•™ä¸­' ? `
                        <div class="booking-deadline">â³ çµå¸³æœŸé™ï¼š${booking.deadline}</div>
                    ` : ''}
                    ${booking.status === 'å·²ç¢ºèª' && booking.coach ? `
                        <div class="booking-coach">ğŸ‹ï¸ æ•™ç·´ï¼š${booking.coach}</div>
                    ` : ''}
                    ${(booking.status === 'å·²å–æ¶ˆ' || booking.status === 'å·²éæœŸ') && booking.cancelReason ? `
                        <div class="booking-cancel-reason">âŒ ${booking.cancelReason}</div>
                    ` : ''}
                </div>
            `).join('');
        }

        // ============================================
        // åˆ‡æ› Tab
        // ============================================
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            renderBookings();
        }

        // ============================================
        // é ç´„è©³æƒ…
        // ============================================
        function openDetail(bookingId) {
            currentBooking = bookings.find(b => b.id === bookingId);
            if (!currentBooking) return;
            
            // å¡«å…¥è³‡æ–™
            document.getElementById('modalBookingId').textContent = currentBooking.id;
            document.getElementById('modalCourse').textContent = currentBooking.course;
            document.getElementById('modalDate').textContent = formatDate(currentBooking.date);
            document.getElementById('modalTime').textContent = `${currentBooking.startTime} - ${currentBooking.endTime}`;
            document.getElementById('modalDisplayName').textContent = currentBooking.displayName || '-';
            document.getElementById('modalDeadline').textContent = currentBooking.deadline;
            
            // æ ¹æ“šç‹€æ…‹é¡¯ç¤ºä¸åŒå…§å®¹
            if (currentBooking.status === 'ä¿ç•™ä¸­') {
                document.getElementById('coachSection').style.display = 'block';
                document.getElementById('actionButtons').style.display = 'block';
                document.getElementById('confirmedInfo').style.display = 'none';
                document.getElementById('cancelledInfo').style.display = 'none';
                loadAvailableCoaches();
            } else if (currentBooking.status === 'å·²ç¢ºèª') {
                document.getElementById('coachSection').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('confirmedInfo').style.display = 'block';
                document.getElementById('cancelledInfo').style.display = 'none';
                document.getElementById('modalCoach').textContent = currentBooking.coach;
                document.getElementById('modalConfirmTime').textContent = currentBooking.confirmTime;
                document.getElementById('modalConfirmBy').textContent = currentBooking.confirmBy;
            } else if (currentBooking.status === 'å·²å–æ¶ˆ' || currentBooking.status === 'å·²éæœŸ') {
                document.getElementById('coachSection').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('confirmedInfo').style.display = 'none';
                document.getElementById('cancelledInfo').style.display = 'block';
                document.getElementById('modalCancelReason').textContent = currentBooking.cancelReason || '-';
                document.getElementById('modalCancelTime').textContent = currentBooking.cancelTime || '-';
                document.getElementById('modalCancelBy').textContent = currentBooking.cancelBy || '-';
                
                // å‚™è¨»
                if (currentBooking.cancelNote) {
                    document.getElementById('cancelNoteRow').style.display = 'flex';
                    document.getElementById('modalCancelNote').textContent = currentBooking.cancelNote;
                } else {
                    document.getElementById('cancelNoteRow').style.display = 'none';
                }
            } else {
                document.getElementById('coachSection').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('confirmedInfo').style.display = 'none';
                document.getElementById('cancelledInfo').style.display = 'none';
            }
            
            document.getElementById('detailModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
            currentBooking = null;
            selectedCoach = null;
        }

        // ============================================
        // è¼‰å…¥å¯ç”¨æ•™ç·´
        // ============================================
        async function loadAvailableCoaches() {
    const coachList = document.getElementById('coachList');
    coachList.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
    
    try {
        if (!CONFIG.WEBHOOK_URL) {
            coachList.innerHTML = '<p style="color: var(--pink-dark);">è«‹å…ˆè¨­å®š Webhook URL</p>';
            return;
        }
        
        const response = await fetch(CONFIG.WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'getAvailableCoaches',
                course: currentBooking.course,
                date: currentBooking.date,
                startTime: currentBooking.startTime,
                endTime: currentBooking.endTime,
                originalCoach: currentBooking.coach || ''
            })
        });
        let coaches = await response.json();
        
        // âœ… å»é‡ï¼šæ ¹æ“šæ•™ç·´åç¨±å»é™¤é‡è¤‡ï¼Œä¿ç•™ç¬¬ä¸€å€‹ï¼ˆisOriginal å„ªå…ˆï¼‰
        const seen = new Set();
        coaches = coaches.filter(coach => {
            if (seen.has(coach.name)) {
                return false;
            }
            seen.add(coach.name);
            return true;
        });
        
        if (coaches.length === 0) {
            coachList.innerHTML = '<p style="color: var(--gray); text-align: center;">æ²’æœ‰å¯ç”¨æ•™ç·´</p>';
            return;
        }
        
        coachList.innerHTML = coaches.map(coach => `
            <div class="coach-option ${coach.isOriginal ? 'original' : ''}" 
                 onclick="selectCoach('${coach.name}', this)">
                <div class="coach-radio"></div>
                <span class="coach-name">${coach.name}</span>
                ${coach.isOriginal ? '<span class="coach-tag">åŸæ™‚æ®µ</span>' : ''}
            </div>
        `).join('');
        
    } catch (error) {
        console.error('Load coaches failed:', error);
        coachList.innerHTML = '<p style="color: var(--pink-dark);">è¼‰å…¥å¤±æ•—</p>';
    }
}
        
        function selectCoach(coachName, element) {
            selectedCoach = coachName;
            
            // æ›´æ–° UI
            document.querySelectorAll('.coach-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            // å•Ÿç”¨ç¢ºèªæŒ‰éˆ•
            document.getElementById('confirmBtn').disabled = false;
        }

        // ============================================
        // ç¢ºèªé ç´„
        // ============================================
        async function confirmBooking() {
            if (!currentBooking || !selectedCoach) return;
            
            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;"></div> è™•ç†ä¸­...';
            
            try {
                if (CONFIG.WEBHOOK_URL) {
                    // æ­£å¼ç‰ˆï¼šå‘¼å« Webhook
                    const response = await fetch(CONFIG.WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'confirmBooking',
                            bookingId: currentBooking.id,
                            rowNumber: currentBooking.rowNumber,
                            course: currentBooking.course,
                            date: currentBooking.date,
                            startTime: currentBooking.startTime,
                            endTime: currentBooking.endTime,
                            lineId: currentBooking.lineId,
                            coach: selectedCoach,
                            confirmedBy: userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡'
                        })
                    });
                    const result = await response.json();
                } else {
                    // æ¸¬è©¦ç‰ˆï¼šæ¨¡æ“¬æˆåŠŸ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                // æ›´æ–°æœ¬åœ°è³‡æ–™
                const index = bookings.findIndex(b => b.id === currentBooking.id);
                if (index !== -1) {
                    bookings[index].status = 'å·²ç¢ºèª';
                    bookings[index].coach = selectedCoach;
                    bookings[index].confirmTime = new Date().toLocaleString('zh-TW');
                    bookings[index].confirmBy = userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡';
                }
                
                closeModal();
                updateStats();
                renderBookings();
                showToast('âœ… é ç´„å·²ç¢ºèªï¼å·²é€šçŸ¥é¡§å®¢', 'success');
                
            } catch (error) {
                console.error('Confirm booking failed:', error);
                showToast('ç¢ºèªå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = 'âœ… ç¢ºèªä»˜æ¬¾ä¸¦åˆ†é…æ•™ç·´';
            }
        }

        // ============================================
        // å–æ¶ˆé ç´„ï¼ˆæœªä»˜æ¬¾ï¼‰
        // ============================================
        function showCancelConfirm() {
    document.getElementById('cancelNoteUnpaid').value = '';
    document.getElementById('cancelConfirmModal').classList.add('active');
}

        function closeCancelConfirm() {
            document.getElementById('cancelConfirmModal').classList.remove('active');
        }

        async function cancelBooking() {
            if (!currentBooking) return;
            
            const note = document.getElementById('cancelNoteUnpaid').value;
            
            try {
                if (CONFIG.WEBHOOK_URL) {
                    // æ­£å¼ç‰ˆï¼šå‘¼å« Webhook
                    const response = await fetch(CONFIG.WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'adminCancelBooking',
                            bookingId: currentBooking.id,
                            rowNumber: currentBooking.rowNumber,
                            course: currentBooking.course,
                            date: currentBooking.date,
                            startTime: currentBooking.startTime,
                            endTime: currentBooking.endTime,
                            lineId: currentBooking.lineId,
                            cancelReason: 'è¡Œæ”¿äººå“¡å–æ¶ˆï¼ˆæœªä»˜æ¬¾ï¼‰',
                            note: note,
                            cancelledBy: userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡'
                        })
                    });
                } else {
                    // æ¸¬è©¦ç‰ˆï¼šæ¨¡æ“¬æˆåŠŸ
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // æ›´æ–°æœ¬åœ°è³‡æ–™
                const index = bookings.findIndex(b => b.id === currentBooking.id);
                if (index !== -1) {
                    bookings[index].status = 'å·²å–æ¶ˆ';
                    bookings[index].cancelReason = 'è¡Œæ”¿äººå“¡å–æ¶ˆï¼ˆæœªä»˜æ¬¾ï¼‰';
                    bookings[index].cancelTime = new Date().toLocaleString('zh-TW');
                    bookings[index].cancelBy = userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡';
                }
                
                closeCancelConfirm();
                closeModal();
                updateStats();
                renderBookings();
                showToast('é ç´„å·²å–æ¶ˆï¼Œå·²é€šçŸ¥é¡§å®¢', 'success');
                
            } catch (error) {
                console.error('Cancel booking failed:', error);
                showToast('å–æ¶ˆå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // ============================================
        // é€€æ¬¾å–æ¶ˆï¼ˆå·²ä»˜æ¬¾çš„é ç´„ï¼‰
        // ============================================
        function showRefundCancelModal() {
            document.getElementById('cancelReason').value = '';
            document.getElementById('cancelNote').value = '';
            refundConfirmed = false;
            document.getElementById('refundCheckbox').classList.remove('checked');
            document.querySelector('.checkbox-label').classList.remove('checked');
            document.getElementById('refundCancelBtn').disabled = true;
            document.getElementById('refundCancelModal').classList.add('active');
        }

        function closeRefundCancelModal() {
            document.getElementById('refundCancelModal').classList.remove('active');
        }

        function toggleRefundConfirm() {
            refundConfirmed = !refundConfirmed;
            const checkbox = document.getElementById('refundCheckbox');
            const label = document.querySelector('.checkbox-label');
            
            if (refundConfirmed) {
                checkbox.classList.add('checked');
                label.classList.add('checked');
            } else {
                checkbox.classList.remove('checked');
                label.classList.remove('checked');
            }
            
            checkRefundForm();
        }

        // ç›£è½é¸é …è®Šæ›´
        document.addEventListener('DOMContentLoaded', function() {
            const cancelReason = document.getElementById('cancelReason');
            
            if (cancelReason) {
                cancelReason.addEventListener('change', checkRefundForm);
            }
        });

        function checkRefundForm() {
            const reason = document.getElementById('cancelReason').value;
            document.getElementById('refundCancelBtn').disabled = !(reason && refundConfirmed);
        }

        async function confirmRefundCancel() {
            if (!currentBooking) return;
            
            const reason = document.getElementById('cancelReason').value;
            const note = document.getElementById('cancelNote').value;
            
            if (!reason || !refundConfirmed) {
                showToast('è«‹é¸æ“‡å–æ¶ˆåŸå› ä¸¦ç¢ºèªå·²è¾¦ç†é€€æ¬¾', 'error');
                return;
            }
            
            const refundCancelBtn = document.getElementById('refundCancelBtn');
            refundCancelBtn.disabled = true;
            refundCancelBtn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;"></div> è™•ç†ä¸­...';
            
            try {
                if (CONFIG.WEBHOOK_URL) {
                    // æ­£å¼ç‰ˆï¼šå‘¼å« Webhook
                    const response = await fetch(CONFIG.WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'refundCancelBooking',
                            bookingId: currentBooking.id,
                            rowNumber: currentBooking.rowNumber,
                            course: currentBooking.course,
                            date: currentBooking.date,
                            startTime: currentBooking.startTime,
                            endTime: currentBooking.endTime,
                            lineId: currentBooking.lineId,
                            cancelReason: reason,
                            note: note,
                            cancelledBy: userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡'
                        })
                    });
                } else {
                    // æ¸¬è©¦ç‰ˆï¼šæ¨¡æ“¬æˆåŠŸ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                // æ›´æ–°æœ¬åœ°è³‡æ–™
                const index = bookings.findIndex(b => b.id === currentBooking.id);
                if (index !== -1) {
                    bookings[index].status = 'å·²å–æ¶ˆ';
                    bookings[index].cancelReason = reason;
                    bookings[index].cancelTime = new Date().toLocaleString('zh-TW');
                    bookings[index].cancelBy = userProfile ? userProfile.displayName : 'è¡Œæ”¿äººå“¡';
                    bookings[index].cancelNote = note;
                }
                
                closeRefundCancelModal();
                closeModal();
                updateStats();
                renderBookings();
                showToast('âœ… é ç´„å·²å–æ¶ˆï¼Œæ™‚æ®µå·²é‡‹å‡ºï¼Œå·²é€šçŸ¥é¡§å®¢', 'success');
                
            } catch (error) {
                console.error('Refund cancel failed:', error);
                showToast('å–æ¶ˆå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                refundCancelBtn.disabled = false;
                refundCancelBtn.innerHTML = 'ç¢ºèªå–æ¶ˆ';
            }
        }

        // ============================================
        // å·¥å…·å‡½æ•¸
        // ============================================
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')} (${weekdays[date.getDay()]})`;
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
